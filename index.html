<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malla Bioanálisis UCV</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #ffffff;
            color: #333;
            padding: 10px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .malla-container {
            display: flex;
            overflow-x: auto;
            gap: 12px;
            padding: 8px 4px;
            scrollbar-width: thin;
            scrollbar-color: #000080 #f0f0f0;
        }
        
        .malla-container::-webkit-scrollbar {
            height: 6px;
        }
        
        .malla-container::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 3px;
        }
        
        .malla-container::-webkit-scrollbar-thumb {
            background: #000080;
            border-radius: 3px;
        }
        
        .semestre {
            min-width: 200px;
            border: 2px solid #0E0E55;
            border-radius: 10px;
            background: white;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        
        .semestre-header {
            background: #000080;
            color: white;
            text-align: center;
            padding: 8px;
            font-weight: 600;
            font-size: 16px;
            border-radius: 8px 8px 0 0;
        }
        
        .materias-container {
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-height: 280px;
        }
        
        .materia {
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            border: 1px solid #ddd;
            font-size: 13px;
        }
        
        .materia.available {
            background: #FFEE8C;
            color: black;
        }
        
        .materia.completed {
            background: #E05F77;
            color: white;
            text-decoration: line-through;
        }
        
        .materia.locked {
            background: #f0f0f0;
            color: #888;
            cursor: not-allowed;
        }
        
        .materia.available:hover {
            transform: translateY(-3px);
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        
        .materia.completed:hover {
            background: #d04a63;
        }
        
        .materia h4 {
            margin-bottom: 4px;
            font-weight: 600;
        }
        
        .creditos {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .codigo {
            font-size: 11px;
            opacity: 0.8;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0 10px;
            flex-wrap: wrap;
        }
        
        .stat-card {
            background: #f0f8ff;
            border: 1px solid #0E0E55;
            border-radius: 8px;
            padding: 8px;
            min-width: 120px;
            text-align: center;
            font-size: 12px;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #000080;
            margin: 4px 0;
        }
        
        .progress-container {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-top: 4px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #000080, #0E0E55);
            border-radius: 4px;
            transition: width 0.3s ease-in-out;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 12px 0;
            font-size: 12px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
        
        .legend-available {
            background: #FFEE8C;
        }
        
        .legend-completed {
            background: #E05F77;
        }
        
        .legend-locked {
            background: #f0f0f0;
        }
        
        @media (max-width: 768px) {
            .semestre {
                min-width: 180px;
            }
            
            .materia {
                padding: 10px;
                font-size: 12px;
            }
            
            .semestre-header {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="malla-container" id="malla-container">
        <!-- Semestres se generarán con JavaScript -->
    </div>
    
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color legend-available"></div>
            <span>Disponible</span>
        </div>
        <div class="legend-item">
            <div class="legend-color legend-completed"></div>
            <span>Completada</span>
        </div>
        <div class="legend-item">
            <div class="legend-color legend-locked"></div>
            <span>Bloqueada</span>
        </div>
    </div>
    
    <div class="stats">
        <div class="stat-card">
            <div>Créditos</div>
            <div class="stat-value" id="creditos-completados">0</div>
            <div>de 169</div>
        </div>
        <div class="stat-card">
            <div>Materias</div>
            <div class="stat-value" id="materias-completadas">0</div>
            <div>de 47</div>
        </div>
        <div class="stat-card">
            <div>Progreso</div>
            <div class="progress-container">
                <div class="progress-bar" id="progreso-general" style="width: 0%"></div>
            </div>
            <div class="stat-value" id="porcentaje-progreso">0%</div>
        </div>
    </div>

    <script>
        // Datos completos del pensum
        const pensum = [
            // Semestre 1
            {
                semestre: 1,
                materias: [
                    { id: "bioestadistica1", nombre: "Bioestadística I", codigo: "0902003458", creditos: 4, requisitos: [] },
                    { id: "matematica1", nombre: "Matemática I", codigo: "0902003455", creditos: 3, requisitos: [] },
                    { id: "histologia", nombre: "Histología", codigo: "0902003456", creditos: 5, requisitos: [] },
                    { id: "metodologia", nombre: "Metodología Inv.", codigo: "0902003459", creditos: 1, requisitos: [] },
                    { id: "principios_quimica", nombre: "Principios de Química", codigo: "0902003457", creditos: 3, requisitos: [] }
                ]
            },
            // Semestre 2
            {
                semestre: 2,
                materias: [
                    { id: "anatomia1", nombre: "Anatomía y Embriología I", codigo: "0902002520", creditos: 4, requisitos: ["histologia"] },
                    { id: "matematica2", nombre: "Matemática II", codigo: "0902003460", creditos: 4, requisitos: ["matematica1"] },
                    { id: "fisica1", nombre: "Física I", codigo: "0902003274", creditos: 4, requisitos: ["matematica1"] },
                    { id: "quimica_organica1", nombre: "Química Orgánica I", codigo: "0902003461", creditos: 4, requisitos: ["principios_quimica"] }
                ]
            },
            // Semestre 3
            {
                semestre: 3,
                materias: [
                    { id: "epidemiologia", nombre: "Epidemiología", codigo: "0902003288", creditos: 3, requisitos: ["bioestadistica1"] },
                    { id: "anatomia2", nombre: "Anatomía II", codigo: "0902002526", creditos: 2, requisitos: ["anatomia1"] },
                    { id: "fisica2", nombre: "Física II", codigo: "0902003275", creditos: 4, requisitos: ["fisica1", "matematica1"] },
                    { id: "quimica_analitica", nombre: "Química Analítica", codigo: "0902002523", creditos: 5, requisitos: ["principios_quimica"] }
                ]
            },
            // Semestre 4
            {
                semestre: 4,
                materias: [
                    { id: "bioquimica1", nombre: "Bioquímica I", codigo: "0902002991", creditos: 6, requisitos: ["quimica_organica1", "quimica_analitica", "bioestadistica1"] },
                    { id: "fisiologia", nombre: "Fisiología", codigo: "0902002994", creditos: 5, requisitos: ["histologia", "fisica2"] },
                    { id: "sociologia", nombre: "Sociología", codigo: "0902003462", creditos: 3, requisitos: ["anatomia1"] }
                ]
            },
            // Semestre 5
            {
                semestre: 5,
                materias: [
                    { id: "bioquimica2", nombre: "Bioquímica II", codigo: "0902002992", creditos: 2, requisitos: ["bioquimica1"] },
                    { id: "bacteriologia1", nombre: "Bacteriología I", codigo: "0902003465", creditos: 3, requisitos: ["bioquimica1"] },
                    { id: "inmunologia1", nombre: "Immunología I", codigo: "0902002999", creditos: 2, requisitos: ["bioquimica1"] },
                    { id: "deontologia", nombre: "Deontología", codigo: "0902003464", creditos: 3, requisitos: ["45creditos"] },
                    { id: "administracion", nombre: "Administración Sanitaria", codigo: "0902003463", creditos: 3, requisitos: ["40creditos"] }
                ]
            },
            // Semestre 6
            {
                semestre: 6,
                materias: [
                    { id: "bioquimica_clinica1", nombre: "Bioquímica Cl. I", codigo: "0902003277", creditos: 5, requisitos: ["fisiologia", "bioquimica2"] },
                    { id: "bacteriologia2", nombre: "Bacteriología II", codigo: "0902003466", creditos: 4, requisitos: ["bacteriologia1", "inmunologia1"] },
                    { id: "lab_inmunologia", nombre: "Laboratorio de Inmunología", codigo: "0902003278", creditos: 2, requisitos: ["inmunologia1", "bacteriologia1"] },
                    { id: "micologia1", nombre: "Micología I", codigo: "0902003279", creditos: 3, requisitos: ["bacteriologia1", "inmunologia1", "epidemiologia"] }
                ]
            },
            // Semestre 7
            {
                semestre: 7,
                materias: [
                    { id: "bacteriologia3", nombre: "Bacteriología III", codigo: "0902003467", creditos: 4, requisitos: ["bacteriologia2"] },
                    { id: "hematologia1", nombre: "Hematología I", codigo: "0902003280", creditos: 5, requisitos: ["fisiologia", "bioquimica2", "lab_inmunologia"] },
                    { id: "parasitologia1", nombre: "Parasitología I", codigo: "0902002988", creditos: 4, requisitos: ["lab_inmunologia"] },
                    { id: "virologia", nombre: "Virología", codigo: "0902003284", creditos: 3, requisitos: ["lab_inmunologia", "fisiologia"] }
                ]
            },
            // Semestre 8
            {
                semestre: 8,
                materias: [
                    { id: "bioquimica_clinica2", nombre: "Bioquímica Cl. II", codigo: "0902003281", creditos: 5, requisitos: ["bioquimica_clinica1", "hematologia1"] },
                    { id: "hematologia2", nombre: "Hematología II", codigo: "0902003282", creditos: 5, requisitos: ["hematologia1"] },
                    { id: "parasitologia2", nombre: "Parasitología II", codigo: "0902003283", creditos: 3, requisitos: ["lab_inmunologia"] },
                    { id: "toxicologia", nombre: "Toxicología", codigo: "0902003285", creditos: 5, requisitos: ["hematologia1", "bioquimica_clinica1"] }
                ]
            },
            // Semestre 9-10
            {
                semestre: "9-10",
                materias: [
                    { id: "internado", nombre: "Internado R + TEI", codigo: "0902003508", creditos: 30, requisitos: ["pre-internado"] },
                    { id: "electivas", nombre: "Asignaturas electivas", codigo: "", creditos: 18, requisitos: [] }
                ]
            }
        ];

        // Estado de las materias
        let estadoMaterias = {};
        
        // Inicializar
        function init() {
            // Cargar estado guardado si existe
            const guardado = localStorage.getItem('estadoMaterias');
            if (guardado) {
                estadoMaterias = JSON.parse(guardado);
            } else {
                // Inicializar todas como no completadas
                pensum.forEach(semestre => {
                    semestre.materias.forEach(materia => {
                        estadoMaterias[materia.id] = false;
                    });
                });
            }
            
            renderMalla();
            actualizarEstadisticas();
        }
        
        // Renderizar la malla
        function renderMalla() {
            const container = document.getElementById('malla-container');
            container.innerHTML = '';
            
            pensum.forEach(semestre => {
                const semestreDiv = document.createElement('div');
                semestreDiv.className = 'semestre';
                
                const header = document.createElement('div');
                header.className = 'semestre-header';
                header.textContent = `Semestre ${semestre.semestre}`;
                semestreDiv.appendChild(header);
                
                const materiasContainer = document.createElement('div');
                materiasContainer.className = 'materias-container';
                
                semestre.materias.forEach(materia => {
                    const materiaDiv = document.createElement('div');
                    materiaDiv.className = 'materia';
                    
                    // Determinar el estado de la materia
                    if (estadoMaterias[materia.id]) {
                        materiaDiv.classList.add('completed');
                    } else if (estaDisponible(materia)) {
                        materiaDiv.classList.add('available');
                    } else {
                        materiaDiv.classList.add('locked');
                    }
                    
                    // Contenido de la materia
                    materiaDiv.innerHTML = `
                        <h4>${materia.nombre}</h4>
                        <div class="codigo">${materia.codigo}</div>
                        <div class="creditos">${materia.creditos} CR</div>
                    `;
                    
                    // Evento click para marcar/desmarcar
                    materiaDiv.addEventListener('click', () => {
                        if (materiaDiv.classList.contains('available') || materiaDiv.classList.contains('completed')) {
                            estadoMaterias[materia.id] = !estadoMaterias[materia.id];
                            localStorage.setItem('estadoMaterias', JSON.stringify(estadoMaterias));
                            renderMalla();
                            actualizarEstadisticas();
                        }
                    });
                    
                    materiasContainer.appendChild(materiaDiv);
                });
                
                semestreDiv.appendChild(materiasContainer);
                container.appendChild(semestreDiv);
            });
        }
        
        // Verificar si una materia está disponible
        function estaDisponible(materia) {
            if (estadoMaterias[materia.id]) return false; // Ya completada
            
            // Verificar requisitos especiales
            if (materia.requisitos.includes('45creditos')) {
                if (calcularCreditosCompletados() < 45) return false;
            }
            
            if (materia.requisitos.includes('40creditos')) {
                if (calcularCreditosCompletados() < 40) return false;
            }
            
            if (materia.requisitos.includes('pre-internado')) {
                // Verificar que todas las materias de semestres 1-8 estén completadas
                const materiasPre = pensum.filter(s => s.semestre !== "9-10").flatMap(s => s.materias);
                for (const m of materiasPre) {
                    if (!estadoMaterias[m.id]) return false;
                }
            }
            
            // Verificar requisitos normales
            for (const reqId of materia.requisitos) {
                if (reqId !== '45creditos' && reqId !== '40creditos' && reqId !== 'pre-internado') {
                    if (!estadoMaterias[reqId]) {
                        return false;
                    }
                }
            }
            
            return true;
        }
        
        // Calcular créditos completados
        function calcularCreditosCompletados() {
            let total = 0;
            pensum.forEach(semestre => {
                semestre.materias.forEach(materia => {
                    if (estadoMaterias[materia.id]) {
                        total += materia.creditos;
                    }
                });
            });
            return total;
        }
        
        // Calcular materias completadas
        function calcularMateriasCompletadas() {
            return Object.values(estadoMaterias).filter(v => v).length;
        }
        
        // Actualizar estadísticas
        function actualizarEstadisticas() {
            const creditos = calcularCreditosCompletados();
            const materias = calcularMateriasCompletadas();
            const porcentaje = Math.round((creditos / 169) * 100);
            
            document.getElementById('creditos-completados').textContent = creditos;
            document.getElementById('materias-completadas').textContent = materias;
            document.getElementById('porcentaje-progreso').textContent = `${porcentaje}%`;
            document.getElementById('progreso-general').style.width = `${porcentaje}%`;
        }
        
        // Inicializar cuando el documento esté cargado
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
