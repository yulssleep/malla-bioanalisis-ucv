<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malla Interactiva Bioan√°lisis - UCV</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background-color: white;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 15px;
            border-bottom: 3px solid #0E0E55;
        }
        
        h1 {
            color: #0E0E55;
            margin-bottom: 10px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        button {
            background: #000080;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            background: #0E0E55;
            transform: translateY(-2px);
        }
        
        button i {
            font-size: 18px;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .stat-card {
            background: #f0f8ff;
            border: 2px solid #0E0E55;
            border-radius: 10px;
            padding: 15px;
            min-width: 180px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #000080;
        }
        
        .malla-container {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 15px 5px;
            margin-top: 20px;
        }
        
        .semestre {
            min-width: 250px;
            border: 3px solid #0E0E55;
            border-radius: 12px;
            background: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
        }
        
        .semestre-header {
            background: #000080;
            color: white;
            text-align: center;
            padding: 12px;
            font-weight: bold;
            font-size: 20px;
            border-radius: 8px 8px 0 0;
        }
        
        .materias-container {
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 400px;
        }
        
        .materia {
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            border: 1px solid #ddd;
        }
        
        .materia.available {
            background: #FFEE8C;
            color: black;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        
        .materia.completed {
            background: #E05F77;
            color: white;
            text-decoration: line-through;
        }
        
        .materia.locked {
            background: #f0f0f0;
            color: #888;
            cursor: not-allowed;
        }
        
        .materia.available:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        
        .materia h4 {
            margin-bottom: 5px;
            font-size: 16px;
        }
        
        .creditos {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.1);
            border-radius: 12px;
            padding: 3px 8px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .codigo {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .progress-container {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #000080, #0E0E55);
            border-radius: 5px;
            transition: width 0.5s;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #000080;
        }
        
        .prereq {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #ddd;
        }
        
        .prereq-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
        }
        
        .prereq-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .prereq-status.completed {
            background: #E05F77;
            color: white;
        }
        
        .reset-section {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .semestre {
                min-width: 220px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>LICENCIATURA EN BIOAN√ÅLISIS - UCV</h1>
        <p>Malla curricular interactiva</p>
    </header>
    
    <div class="controls">
        <button id="btn-todo">
            <i>‚úì</i> Ver todas las materias
        </button>
        <button id="btn-guardar">
            <i>üíæ</i> Guardar mi progreso
        </button>
        <button id="btn-cargar">
            <i>üìÇ</i> Cargar progreso
        </button>
        <button id="btn-reset">
            <i>üîÑ</i> Reiniciar
        </button>
    </div>
    
    <div class="stats">
        <div class="stat-card">
            <div>Cr√©ditos completados</div>
            <div class="stat-value" id="creditos-completados">0</div>
            <div>de 169 totales</div>
        </div>
        <div class="stat-card">
            <div>Materias completadas</div>
            <div class="stat-value" id="materias-completadas">0</div>
            <div>de 47 totales</div>
        </div>
        <div class="stat-card">
            <div>Progreso general</div>
            <div class="progress-container">
                <div class="progress-bar" id="progreso-general" style="width: 0%"></div>
            </div>
            <div class="stat-value" id="porcentaje-progreso">0%</div>
        </div>
    </div>
    
    <div class="malla-container" id="malla-container">
        <!-- Semestres se generar√°n con JavaScript -->
    </div>
    
    <div class="reset-section">
        <button id="btn-reset-completo" style="background: #E05F77;">
            <i>‚ö†Ô∏è</i> Reiniciar todo el progreso
        </button>
    </div>
    
    <div class="modal" id="detalle-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-modal">&times;</span>
            <h3 id="modal-titulo"></h3>
            <p><strong>C√≥digo:</strong> <span id="modal-codigo"></span></p>
            <p><strong>Cr√©ditos:</strong> <span id="modal-creditos"></span></p>
            <div class="prereq" id="modal-prereq">
                <h4>Requisitos:</h4>
                <div id="prereq-list"></div>
            </div>
            <button id="btn-completar" style="margin-top: 20px; width: 100%;">
                <i>‚úì</i> Marcar como completada
            </button>
        </div>
    </div>

    <script>
        // Datos completos del pensum
        const pensum = [
            // Semestre 1
            {
                semestre: 1,
                materias: [
                    { id: "bioestadistica1", nombre: "Bioestad√≠stica I", codigo: "0902003458", creditos: 4, requisitos: [] },
                    { id: "matematica1", nombre: "Matem√°tica I", codigo: "0902003455", creditos: 3, requisitos: [] },
                    { id: "histologia", nombre: "Histolog√≠a", codigo: "0902003456", creditos: 5, requisitos: [] },
                    { id: "metodologia", nombre: "Metodolog√≠a Inv.", codigo: "0902003459", creditos: 1, requisitos: [] },
                    { id: "principios_quimica", nombre: "Principios de Qu√≠mica", codigo: "0902003457", creditos: 3, requisitos: [] }
                ]
            },
            // Semestre 2
            {
                semestre: 2,
                materias: [
                    { id: "anatomia1", nombre: "Anatom√≠a y Embriolog√≠a I", codigo: "0902002520", creditos: 4, requisitos: ["histologia"] },
                    { id: "matematica2", nombre: "Matem√°tica II", codigo: "0902003460", creditos: 4, requisitos: ["matematica1"] },
                    { id: "fisica1", nombre: "F√≠sica I", codigo: "0902003274", creditos: 4, requisitos: ["matematica1"] },
                    { id: "quimica_organica1", nombre: "Qu√≠mica Org√°nica I", codigo: "0902003461", creditos: 4, requisitos: ["principios_quimica"] }
                ]
            },
            // Semestre 3
            {
                semestre: 3,
                materias: [
                    { id: "epidemiologia", nombre: "Epidemiolog√≠a", codigo: "0902003288", creditos: 3, requisitos: ["bioestadistica1"] },
                    { id: "anatomia2", nombre: "Anatom√≠a II", codigo: "0902002526", creditos: 2, requisitos: ["anatomia1"] },
                    { id: "fisica2", nombre: "F√≠sica II", codigo: "0902003275", creditos: 4, requisitos: ["fisica1", "matematica1"] },
                    { id: "quimica_analitica", nombre: "Qu√≠mica Anal√≠tica", codigo: "0902002523", creditos: 5, requisitos: ["principios_quimica"] }
                ]
            },
            // Semestre 4
            {
                semestre: 4,
                materias: [
                    { id: "bioquimica1", nombre: "Bioqu√≠mica I", codigo: "0902002991", creditos: 6, requisitos: ["quimica_organica1", "quimica_analitica", "bioestadistica1"] },
                    { id: "fisiologia", nombre: "Fisiolog√≠a", codigo: "0902002994", creditos: 5, requisitos: ["histologia", "fisica2"] },
                    { id: "sociologia", nombre: "Sociolog√≠a", codigo: "0902003462", creditos: 3, requisitos: ["anatomia1"] }
                ]
            },
            // Semestre 5
            {
                semestre: 5,
                materias: [
                    { id: "bioquimica2", nombre: "Bioqu√≠mica II", codigo: "0902002992", creditos: 2, requisitos: ["bioquimica1"] },
                    { id: "bacteriologia1", nombre: "Bacteriolog√≠a I", codigo: "0902003465", creditos: 3, requisitos: ["bioquimica1"] },
                    { id: "inmunologia1", nombre: "Immunolog√≠a I", codigo: "0902002999", creditos: 2, requisitos: ["bioquimica1"] },
                    { id: "deontologia", nombre: "Deontolog√≠a", codigo: "0902003464", creditos: 3, requisitos: ["45creditos"] },
                    { id: "administracion", nombre: "Administraci√≥n Sanitaria", codigo: "0902003463", creditos: 3, requisitos: ["40creditos"] }
                ]
            },
            // Semestre 6
            {
                semestre: 6,
                materias: [
                    { id: "bioquimica_clinica1", nombre: "Bioqu√≠mica Cl. I", codigo: "0902003277", creditos: 5, requisitos: ["fisiologia", "bioquimica2"] },
                    { id: "bacteriologia2", nombre: "Bacteriolog√≠a II", codigo: "0902003466", creditos: 4, requisitos: ["bacteriologia1", "inmunologia1"] },
                    { id: "lab_inmunologia", nombre: "Laboratorio de Inmunolog√≠a", codigo: "0902003278", creditos: 2, requisitos: ["inmunologia1", "bacteriologia1"] },
                    { id: "micologia1", nombre: "Micolog√≠a I", codigo: "0902003279", creditos: 3, requisitos: ["bacteriologia1", "inmunologia1", "epidemiologia"] }
                ]
            },
            // Semestre 7
            {
                semestre: 7,
                materias: [
                    { id: "bacteriologia3", nombre: "Bacteriolog√≠a III", codigo: "0902003467", creditos: 4, requisitos: ["bacteriologia2"] },
                    { id: "hematologia1", nombre: "Hematolog√≠a I", codigo: "0902003280", creditos: 5, requisitos: ["fisiologia", "bioquimica2", "lab_inmunologia"] },
                    { id: "parasitologia1", nombre: "Parasitolog√≠a I", codigo: "0902002988", creditos: 4, requisitos: ["lab_inmunologia"] },
                    { id: "virologia", nombre: "Virolog√≠a", codigo: "0902003284", creditos: 3, requisitos: ["lab_inmunologia", "fisiologia"] }
                ]
            },
            // Semestre 8
            {
                semestre: 8,
                materias: [
                    { id: "bioquimica_clinica2", nombre: "Bioqu√≠mica Cl. II", codigo: "0902003281", creditos: 5, requisitos: ["bioquimica_clinica1", "hematologia1"] },
                    { id: "hematologia2", nombre: "Hematolog√≠a II", codigo: "0902003282", creditos: 5, requisitos: ["hematologia1"] },
                    { id: "parasitologia2", nombre: "Parasitolog√≠a II", codigo: "0902003283", creditos: 3, requisitos: ["lab_inmunologia"] },
                    { id: "toxicologia", nombre: "Toxicolog√≠a", codigo: "0902003285", creditos: 5, requisitos: ["hematologia1", "bioquimica_clinica1"] }
                ]
            },
            // Semestre 9-10
            {
                semestre: "9-10",
                materias: [
                    { id: "internado", nombre: "Internado R + TEI", codigo: "0902003508", creditos: 30, requisitos: ["pre-internado"] },
                    { id: "electivas", nombre: "Asignaturas electivas", codigo: "", creditos: 18, requisitos: [] }
                ]
            }
        ];

        // Estado de las materias
        let estadoMaterias = {};
        let materiaActual = null;
        
        // Inicializar
        function init() {
            // Cargar estado guardado si existe
            const guardado = localStorage.getItem('estadoMaterias');
            if (guardado) {
                estadoMaterias = JSON.parse(guardado);
            } else {
                // Inicializar todas como no completadas
                pensum.forEach(semestre => {
                    semestre.materias.forEach(materia => {
                        estadoMaterias[materia.id] = false;
                    });
                });
            }
            
            renderMalla();
            actualizarEstadisticas();
            
            // Event listeners
            document.getElementById('close-modal').addEventListener('click', cerrarModal);
            document.getElementById('btn-completar').addEventListener('click', completarMateria);
            document.getElementById('btn-todo').addEventListener('click', verTodasMaterias);
            document.getElementById('btn-guardar').addEventListener('click', guardarProgreso);
            document.getElementById('btn-cargar').addEventListener('click', cargarProgreso);
            document.getElementById('btn-reset').addEventListener('click', reiniciarProgreso);
            document.getElementById('btn-reset-completo').addEventListener('click', reiniciarTodo);
        }
        
        // Renderizar la malla
        function renderMalla() {
            const container = document.getElementById('malla-container');
            container.innerHTML = '';
            
            pensum.forEach(semestre => {
                const semestreDiv = document.createElement('div');
                semestreDiv.className = 'semestre';
                
                const header = document.createElement('div');
                header.className = 'semestre-header';
                header.textContent = `Semestre ${semestre.semestre}`;
                semestreDiv.appendChild(header);
                
                const materiasContainer = document.createElement('div');
                materiasContainer.className = 'materias-container';
                
                semestre.materias.forEach(materia => {
                    const materiaDiv = document.createElement('div');
                    materiaDiv.className = 'materia';
                    
                    // Determinar el estado de la materia
                    if (estadoMaterias[materia.id]) {
                        materiaDiv.classList.add('completed');
                    } else if (estaDisponible(materia)) {
                        materiaDiv.classList.add('available');
                    } else {
                        materiaDiv.classList.add('locked');
                    }
                    
                    // Contenido de la materia
                    materiaDiv.innerHTML = `
                        <h4>${materia.nombre}</h4>
                        <div class="codigo">${materia.codigo}</div>
                        <div class="creditos">${materia.creditos} CR</div>
                    `;
                    
                    // Evento click solo para materias disponibles
                    if (estaDisponible(materia)) {
                        materiaDiv.addEventListener('click', () => {
                            mostrarDetalleMateria(materia);
                        });
                    }
                    
                    materiasContainer.appendChild(materiaDiv);
                });
                
                semestreDiv.appendChild(materiasContainer);
                container.appendChild(semestreDiv);
            });
        }
        
        // Verificar si una materia est√° disponible
        function estaDisponible(materia) {
            if (estadoMaterias[materia.id]) return false; // Ya completada
            
            // Verificar requisitos especiales
            if (materia.requisitos.includes('45creditos')) {
                if (calcularCreditosCompletados() < 45) return false;
            }
            
            if (materia.requisitos.includes('40creditos')) {
                if (calcularCreditosCompletados() < 40) return false;
            }
            
            if (materia.requisitos.includes('pre-internado')) {
                // Verificar que todas las materias de semestres 1-8 est√©n completadas
                const materiasPre = pensum.filter(s => s.semestre !== "9-10").flatMap(s => s.materias);
                for (const m of materiasPre) {
                    if (!estadoMaterias[m.id]) return false;
                }
            }
            
            // Verificar requisitos normales
            for (const reqId of materia.requisitos) {
                if (reqId !== '45creditos' && reqId !== '40creditos' && reqId !== 'pre-internado') {
                    if (!estadoMaterias[reqId]) {
                        return false;
                    }
                }
            }
            
            return true;
        }
        
        // Mostrar detalles de una materia
        function mostrarDetalleMateria(materia) {
            materiaActual = materia;
            const modal = document.getElementById('detalle-modal');
            const titulo = document.getElementById('modal-titulo');
            const codigo = document.getElementById('modal-codigo');
            const creditos = document.getElementById('modal-creditos');
            const prereqList = document.getElementById('prereq-list');
            
            titulo.textContent = materia.nombre;
            codigo.textContent = materia.codigo;
            creditos.textContent = materia.creditos;
            
            prereqList.innerHTML = '';
            
            if (materia.requisitos.length === 0) {
                prereqList.innerHTML = '<p>No tiene requisitos previos</p>';
            } else {
                materia.requisitos.forEach(reqId => {
                    // Requisitos especiales
                    if (reqId === '45creditos') {
                        const item = document.createElement('div');
                        item.className = 'prereq-item';
                        const completado = calcularCreditosCompletados() >= 45;
                        
                        item.innerHTML = `
                            <div class="prereq-status ${completado ? 'completed' : ''}">${completado ? '‚úì' : ''}</div>
                            <div>45 cr√©ditos completados</div>
                        `;
                        prereqList.appendChild(item);
                    } else if (reqId === '40creditos') {
                        const item = document.createElement('div');
                        item.className = 'prereq-item';
                        const completado = calcularCreditosCompletados() >= 40;
                        
                        item.innerHTML = `
                            <div class="prereq-status ${completado ? 'completed' : ''}">${completado ? '‚úì' : ''}</div>
                            <div>40 cr√©ditos completados</div>
                        `;
                        prereqList.appendChild(item);
                    } else if (reqId === 'pre-internado') {
                        const item = document.createElement('div');
                        item.className = 'prereq-item';
                        const completado = verificarPreInternado();
                        
                        item.innerHTML = `
                            <div class="prereq-status ${completado ? 'completed' : ''}">${completado ? '‚úì' : ''}</div>
                            <div>Todas las materias pre-internado completadas</div>
                        `;
                        prereqList.appendChild(item);
                    } else {
                        // Requisitos normales
                        const reqMateria = encontrarMateriaPorId(reqId);
                        if (reqMateria) {
                            const item = document.createElement('div');
                            item.className = 'prereq-item';
                            const completado = estadoMaterias[reqId];
                            
                            item.innerHTML = `
                                <div class="prereq-status ${completado ? 'completed' : ''}">${completado ? '‚úì' : ''}</div>
                                <div>${reqMateria.nombre}</div>
                            `;
                            prereqList.appendChild(item);
                        }
                    }
                });
            }
            
            modal.style.display = 'flex';
        }
        
        // Encontrar materia por ID
        function encontrarMateriaPorId(id) {
            for (const semestre of pensum) {
                for (const materia of semestre.materias) {
                    if (materia.id === id) {
                        return materia;
                    }
                }
            }
            return null;
        }
        
        // Cerrar modal
        function cerrarModal() {
            document.getElementById('detalle-modal').style.display = 'none';
        }
        
        // Completar materia
        function completarMateria() {
            if (materiaActual) {
                estadoMaterias[materiaActual.id] = true;
                localStorage.setItem('estadoMaterias', JSON.stringify(estadoMaterias));
                renderMalla();
                actualizarEstadisticas();
                cerrarModal();
            }
        }
        
        // Calcular cr√©ditos completados
        function calcularCreditosCompletados() {
            let total = 0;
            pensum.forEach(semestre => {
                semestre.materias.forEach(materia => {
                    if (estadoMaterias[materia.id]) {
                        total += materia.creditos;
                    }
                });
            });
            return total;
        }
        
        // Calcular materias completadas
        function calcularMateriasCompletadas() {
            return Object.values(estadoMaterias).filter(v => v).length;
        }
        
        // Verificar pre-internado
        function verificarPreInternado() {
            const materiasPre = pensum.filter(s => s.semestre !== "9-10").flatMap(s => s.materias);
            return materiasPre.every(m => estadoMaterias[m.id]);
        }
        
        // Actualizar estad√≠sticas
        function actualizarEstadisticas() {
            const creditos = calcularCreditosCompletados();
            const materias = calcularMateriasCompletadas();
            const porcentaje = Math.round((creditos / 169) * 100);
            
            document.getElementById('creditos-completados').textContent = creditos;
            document.getElementById('materias-completadas').textContent = materias;
            document.getElementById('porcentaje-progreso').textContent = `${porcentaje}%`;
            document.getElementById('progreso-general').style.width = `${porcentaje}%`;
        }
        
        // Ver todas las materias
        function verTodasMaterias() {
            // Mostrar todas las materias como disponibles temporalmente
            const materias = document.querySelectorAll('.materia');
            materias.forEach(m => {
                m.classList.remove('locked');
                if (!m.classList.contains('completed')) {
                    m.classList.add('available');
                }
            });
            
            setTimeout(() => {
                renderMalla();
            }, 3000);
        }
        
        // Guardar progreso
        function guardarProgreso() {
            localStorage.setItem('estadoMaterias', JSON.stringify(estadoMaterias));
            alert('Progreso guardado correctamente ‚úÖ');
        }
        
        // Cargar progreso
        function cargarProgreso() {
            const guardado = localStorage.getItem('estadoMaterias');
            if (guardado) {
                estadoMaterias = JSON.parse(guardado);
                renderMalla();
                actualizarEstadisticas();
                alert('Progreso cargado correctamente ‚úÖ');
            } else {
                alert('No se encontr√≥ progreso guardado');
            }
        }
        
        // Reiniciar progreso
        function reiniciarProgreso() {
            if (confirm('¬øEst√°s seguro de reiniciar tu progreso? Se perder√°n todos los datos guardados.')) {
                localStorage.removeItem('estadoMaterias');
                estadoMaterias = {};
                pensum.forEach(semestre => {
                    semestre.materias.forEach(materia => {
                        estadoMaterias[materia.id] = false;
                    });
                });
                renderMalla();
                actualizarEstadisticas();
            }
        }
        
        // Reiniciar todo
        function reiniciarTodo() {
            if (confirm('¬øEst√°s seguro de reiniciar TODO el progreso? Esta acci√≥n no se puede deshacer.')) {
                localStorage.removeItem('estadoMaterias');
                location.reload();
            }
        }
        
        // Inicializar cuando el documento est√© cargado
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
